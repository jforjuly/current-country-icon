const apiUrl = "http://ip-api.com/json";
const iconMappings = {
  AD: "ad.png.png",
  AE: "ae.png.png",
  AF: "af.png.png",
  AG: "ag.png.png",
  AI: "ai.png.png",
  AL: "al.png.png",
  AM: "am.png.png",
  AO: "ao.png.png",
  AR: "ar.png.png",
  AS: "as.png.png",
  AT: "at.png.png",
  AU: "au.png.png",
  AW: "aw.png.png",
  AX: "ax.png.png",
  AZ: "az.png.png",
  BA: "ba.png.png",
  BB: "bb.png.png",
  BD: "bd.png.png",
  BE: "be.png.png",
  BF: "bf.png.png",
  BG: "bg.png.png",
  BH: "bh.png.png",
  BI: "bi.png.png",
  BJ: "bj.png.png",
  BL: "bl.png.png",
  BM: "bm.png.png",
  BN: "bn.png.png",
  BO: "bo.png.png",
  BQ: "bq.png.png",
  BR: "br.png.png",
  BS: "bs.png.png",
  BT: "bt.png.png",
  BW: "bw.png.png",
  BY: "by.png.png",
  BZ: "bz.png.png",
  CA: "ca.png.png",
  CC: "cc.png.png",
  CD: "cd.png.png",
  CF: "cf.png.png",
  CG: "cg.png.png",
  CH: "ch.png.png",
  CI: "ci.png.png",
  CK: "ck.png.png",
  CL: "cl.png.png",
  CM: "cm.png.png",
  CN: "cn.png.png",
  CO: "co.png.png",
  CR: "cr.png.png",
  CU: "cu.png.png",
  CV: "cv.png.png",
  CW: "cw.png.png",
  CX: "cx.png.png",
  CY: "cy.png.png",
  CZ: "cz.png.png",
  DE: "de.png.png",
  DJ: "dj.png.png",
  DK: "dk.png.png",
  DM: "dm.png.png",
  DO: "do.png.png",
  DZ: "dz.png.png",
  EC: "ec.png.png",
  EE: "ee.png.png",
  EG: "eg.png.png",
  ER: "er.png.png",
  ES: "es.png.png",
  ET: "et.png.png",
  FI: "fi.png.png",
  FJ: "fj.png.png",
  FK: "fk.png.png",
  FM: "fm.png.png",
  FO: "fo.png.png",
  FR: "fr.png.png",
  GA: "ga.png.png",
  GD: "gd.png.png",
  GE: "ge.png.png",
  GG: "gg.png.png",
  GH: "gh.png.png",
  GI: "gi.png.png",
  GL: "gl.png.png",
  GM: "gm.png.png",
  GN: "gn.png.png",
  GQ: "gq.png.png",
  GR: "gr.png.png",
  GT: "gt.png.png",
  GU: "gu.png.png",
  GW: "gw.png.png",
  GY: "gy.png.png",
  HK: "hk.png.png",
  HN: "hn.png.png",
  HR: "hr.png.png",
  HT: "ht.png.png",
  HU: "hu.png.png",
  ID: "id.png.png",
  IE: "ie.png.png",
  IL: "il.png.png",
  IM: "im.png.png",
  IN: "in.png.png",
  IO: "io.png.png",
  IQ: "iq.png.png",
  IR: "ir.png.png",
  IS: "is.png.png",
  IT: "it.png.png",
  JE: "je.png.png",
  JM: "jm.png.png",
  JO: "jo.png.png",
  JP: "jp.png.png",
  KE: "ke.png.png",
  KG: "kg.png.png",
  KH: "kh.png.png",
  KI: "ki.png.png",
  KM: "km.png.png",
  KN: "kn.png.png",
  KP: "kp.png.png",
  KR: "kr.png.png",
  KW: "kw.png.png",
  KY: "ky.png.png",
  KZ: "kz.png.png",
  LA: "la.png.png",
  LB: "lb.png.png",
  LC: "lc.png.png",
  LI: "li.png.png",
  LR: "lr.png.png",
  LS: "ls.png.png",
  LT: "lt.png.png",
  LU: "lu.png.png",
  LV: "lv.png.png",
  LY: "ly.png.png",
  MA: "ma.png.png",
  MC: "mc.png.png",
  MD: "md.png.png",
  ME: "me.png.png",
  MG: "mg.png.png",
  MH: "mh.png.png",
  MK: "mk.png.png",
  ML: "ml.png.png",
  MM: "mm.png.png",
  MN: "mn.png.png",
  MO: "mo.png.png",
  MP: "mp.png.png",
  MQ: "mq.png.png",
  MR: "mr.png.png",
  MS: "ms.png.png",
  MT: "mt.png.png",
  MU: "mu.png.png",
  MV: "mv.png.png",
  MW: "mw.png.png",
  MX: "mx.png.png",
  MY: "my.png.png",
  MZ: "mz.png.png",
  NA: "na.png.png",
  NE: "ne.png.png",
  NF: "nf.png.png",
  NG: "ng.png.png",
  NI: "ni.png.png",
  NL: "nl.png.png",
  NO: "no.png.png",
  NP: "np.png.png",
  NR: "nr.png.png",
  NU: "nu.png.png",
  NZ: "nz.png.png",
  OM: "on.png.png",
  PA: "pa.png.png",
  PE: "pe.png.png",
  PF: "pf.png.png",
  PG: "pg.png.png",
  PH: "ph.png.png",
  PK: "pk.png.png",
  PL: "pl.png.png",
  PN: "pn.png.png",
  PR: "pr.png.png",
  PS: "ps.png.png",
  PT: "pt.png.png",
  PW: "pw.png.png",
  PY: "py.png.png",
  QA: "qa.png.png",
  RO: "ro.png.png",
  RS: "rs.png.png",
  RU: "ru.png.png",
  RW: "rw.png.png",
  SA: "sa.png.png",
  SB: "sb.png.png",
  SC: "sc.png.png",
  SD: "sd.png.png",
  SE: "se.png.png",
  SQ: "sq.png.png",
  SI: "si.png.png",
  SK: "sk.png.png",
  SL: "sl.png.png",
  SM: "sm.png.png",
  SN: "sn.png.png",
  SO: "so.png.png",
  SR: "sr.png.png",
  SS: "ss.png.png",
  ST: "st.png.png",
  SV: "sv.png.png",
  SX: "sx.png.png",
  SY: "sy.png.png",
  SZ: "sz.png.png",
  TC: "tc.png.png",
  TD: "td.png.png",
  TG: "tg.png.png",
  TH: "th.png.png",
  TJ: "tj.png.png",
  TK: "tk.png.png",
  TL: "tl.png.png",
  TM: "tm.png.png",
  TN: "tn.png.png",
  TO: "to.png.png",
  TR: "tr.png.png",
  TT: "tt.png.png",
  TV: "tv.png.png",
  TW: "tw.png.png",
  TZ: "tz.png.png",
  UA: "ua.png.png",
  UG: "ug.png.png",
  UK: "uk.png.png",
  US: "us.png.png",
  UY: "uy.png.png",
  UZ: "uz.png.png",
  VE: "ve.png.png",
  VG: "vg.png.png",
  VI: "vi.png.png",
  VN: "vn.png.png",
  VU: "vu.png.png",
  WS: "ws.png.png",
  YE: "ye.png.png",
  ZA: "za.png.png",
  ZM: "zm.png.png",
  ZW: "zw.png.png",
};
const defaultIcon = "melilla.png";
const iconsFolder = "icons2";
const changeIcon = (jsonResponse) => {
  const countryCode = jsonResponse["countryCode"];
  const newIcon = iconMappings[countryCode] || defaultIcon;
  chrome.browserAction.setIcon({ path: iconsFolder + "/" + newIcon });
};

const interval = 10000;
const updater = () => {
  fetch(apiUrl)
    .then(function (response) {
      return response.json();
    })
    .then(changeIcon);
};
setInterval(updater, interval);
